---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

labels:
  - pairs:
      app.kubernetes.io/part-of: immich
      app.kubernetes.io/managed-by: kustomize
    includeTemplates: true

namespace: immich
resources:
  - namespace.yml
  - pv.yml
  - immich-server
  - immich-machine-learning
  - redis
  - postgres
  - ingress.yml

images:
  - name: immich-server
    newName: ghcr.io/immich-app/immich-server
    newTag: v1.142.0
  - name: immich-machine-learning
    newName: ghcr.io/immich-app/immich-machine-learning
    newTag: v1.142.0
  - name: redis
    newName: docker.io/valkey/valkey
    newTag: 8-bookworm@sha256:fea8b3e67b15729d4bb70589eb03367bab9ad1ee89c876f54327fc7c6e618571
  - name: postgres
    newName: ghcr.io/immich-app/postgres
    newTag: 14-vectorchord0.4.3-pgvectors0.2.0@sha256:8d292bdb796aa58bbbaa47fe971c8516f6f57d6a47e7172e62754feb6ed4e7b0

configMapGenerator:
  - name: immich-server-config
    files:
      - immich.json

secretGenerator:
  - name: immich-server-credentials
    options:
      disableNameSuffixHash: true
    envs:
      - immich-database-credentials.env
  - name: immich-ml-credentials
    options:
      disableNameSuffixHash: true
    envs:
      - immich-database-credentials.env
  - name: postgres-credentials
    options:
      disableNameSuffixHash: true
    envs:
      - immich-database-credentials.env
